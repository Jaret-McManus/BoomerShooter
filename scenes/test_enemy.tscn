[gd_scene load_steps=18 format=3 uid="uid://c08qcm5drvgqp"]

[ext_resource type="Script" uid="uid://cd3odxkjvfuew" path="res://scripts/test_enemy.gd" id="1_mkyue"]
[ext_resource type="Texture2D" uid="uid://dncjnr24af1j0" path="res://textures/enemies/8dir_placeholder.png" id="2_lkcdx"]
[ext_resource type="Script" uid="uid://cpj7ll4l4jsg3" path="res://scripts/component_scripts/health_component.gd" id="3_8c00y"]
[ext_resource type="Script" uid="uid://dgu7dyqnmjcli" path="res://scripts/component_scripts/htibox_component.gd" id="5_1y3pe"]
[ext_resource type="Script" uid="uid://dq0nx7tbltfcj" path="res://scripts/detect_area.gd" id="5_8c00y"]
[ext_resource type="AudioStream" uid="uid://dwuvvwwaifsf5" path="res://audio/painsound2.mp3" id="6_jqw88"]
[ext_resource type="Script" uid="uid://dws1aq5nu2h0w" path="res://scripts/states/enemy/enemy_state_machine.gd" id="7_t46gg"]
[ext_resource type="Script" uid="uid://cltyspx502fe2" path="res://scripts/states/enemy/enemy_idling.gd" id="8_t46gg"]
[ext_resource type="Script" uid="uid://dxbaiavwkmvqq" path="res://scripts/states/enemy/enemy_following.gd" id="9_dddk1"]
[ext_resource type="Script" uid="uid://c2pb3auupa7xm" path="res://scripts/states/enemy/enemy_attacking.gd" id="10_vp4s7"]

[sub_resource type="Animation" id="Animation_8c00y"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_lkcdx"]
resource_name = "idle"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [21]
}

[sub_resource type="Animation" id="Animation_jqw88"]
resource_name = "walk"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.433333, 0.633333),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_1y3pe"]
_data = {
&"RESET": SubResource("Animation_8c00y"),
&"idle": SubResource("Animation_lkcdx"),
&"walk": SubResource("Animation_jqw88")
}

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_yikbh"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_8c00y"]
radius = 0.742797
height = 2.06226

[sub_resource type="SphereShape3D" id="SphereShape3D_lkcdx"]
radius = 17.0

[node name="TestEnemy" type="CharacterBody3D" node_paths=PackedStringArray("ANIMATION_PLAYER", "SPRITE", "SFX")]
collision_layer = 4
collision_mask = 7
script = ExtResource("1_mkyue")
ANIMATION_PLAYER = NodePath("AnimationPlayer")
SPRITE = NodePath("Sprite3D")
SFX = NodePath("SFX")

[node name="SFX" type="AudioStreamPlayer3D" parent="."]
stream = ExtResource("6_jqw88")
volume_db = -29.754

[node name="Sprite3D" type="Sprite3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.090281, 0.107821, 0)
pixel_size = 0.045
texture_filter = 0
texture = ExtResource("2_lkcdx")
hframes = 8
vframes = 5
region_enabled = true
region_rect = Rect2(0, 0, 256, 280)

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_1y3pe")
}
autoplay = "walk"

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_yikbh")

[node name="VisibleOnScreenEnabler3D" type="VisibleOnScreenEnabler3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.163896, 0.0102435, 0)
aabb = AABB(-0.791313, -0.975697, -0.766522, 1.58263, 1.95139, 1.53304)

[node name="HealthComponent" type="Node" parent="."]
script = ExtResource("3_8c00y")
MAX_HEALTH = 30
current_health = 30
metadata/_custom_type_script = "uid://cpj7ll4l4jsg3"

[node name="HitboxComponent" type="Area3D" parent="." node_paths=PackedStringArray("health_component")]
script = ExtResource("5_1y3pe")
health_component = NodePath("../HealthComponent")
metadata/_custom_type_script = "uid://dgu7dyqnmjcli"

[node name="CollisionShape3D" type="CollisionShape3D" parent="HitboxComponent"]
shape = SubResource("CapsuleShape3D_8c00y")
debug_color = Color(0.996928, 0, 0.176858, 0.42)

[node name="DetectArea" type="Area3D" parent="." node_paths=PackedStringArray("DETECT_RAY")]
collision_layer = 4
script = ExtResource("5_8c00y")
DETECT_RAY = NodePath("DetectRay")

[node name="CollisionShape3D" type="CollisionShape3D" parent="DetectArea"]
visible = false
shape = SubResource("SphereShape3D_lkcdx")
debug_color = Color(0, 0.595, 0.7, 0)

[node name="DetectRay" type="RayCast3D" parent="DetectArea"]
enabled = false
target_position = Vector3(0, 0, 17)
collision_mask = 3
debug_shape_custom_color = Color(0, 0, 0, 0)

[node name="EnemyStateMachine" type="Node" parent="." node_paths=PackedStringArray("enemy", "initial_state")]
script = ExtResource("7_t46gg")
enemy = NodePath("..")
initial_state = NodePath("Idling")
metadata/_custom_type_script = "uid://davdnjgjqdakh"

[node name="Idling" type="Node" parent="EnemyStateMachine"]
script = ExtResource("8_t46gg")
metadata/_custom_type_script = "uid://7fgtxhgik310"

[node name="Following" type="Node" parent="EnemyStateMachine" node_paths=PackedStringArray("DETECT_RAY")]
script = ExtResource("9_dddk1")
DETECT_RAY = NodePath("../../DetectArea/DetectRay")
metadata/_custom_type_script = "uid://dujbopjc5nrej"

[node name="Attacking" type="Node" parent="EnemyStateMachine" node_paths=PackedStringArray("WINDUP_TIMER", "HEALTH_COMPONENT", "DETECT_RAY")]
script = ExtResource("10_vp4s7")
WINDUP_TIMER = NodePath("WindupTimer")
HEALTH_COMPONENT = NodePath("../../HealthComponent")
DETECT_RAY = NodePath("../../DetectArea/DetectRay")
metadata/_custom_type_script = "uid://dujbopjc5nrej"

[node name="WindupTimer" type="Timer" parent="EnemyStateMachine/Attacking"]
one_shot = true
